# Проект: Тестирование Django-приложения с использованием Pytest

## Описание
Этот проект был создан в рамках курса, посвященного тестированию Django-приложений с использованием библиотеки `pytest`. В проекте реализовано базовое приложение для управления сообщениями, которое тестируется с использованием различных подходов и инструментов для улучшения качества и надежности кода.

## Основные темы, которые мы изучили:

1. **Организация тестов в Django с использованием Pytest**:
   Мы рассмотрели, как использовать библиотеку `pytest` для тестирования Django-приложений. Pytest предлагает гибкие и мощные инструменты для организации тестов, таких как фикстуры и тестовые функции, позволяющие легко создавать тестовые данные и проверять их.

2. **Фикстуры в Pytest**:
   Мы использовали фикстуры для создания тестовых объектов, которые необходимы для выполнения тестов. Это позволило автоматизировать создание тестового окружения (например, клиентов и пользователей), что упрощает настройку и повторное использование кода:
   ```python
   @pytest.fixture
   def client():
       return APIClient()

   @pytest.fixture
   def user():
       return User.objects.create_user('dem2014')
   ```

3. **Использование `model_bakery` для генерации тестовых данных**:
   Мы изучили и применили библиотеку `model_bakery`, которая позволяет автоматически генерировать объекты моделей для тестирования. Это помогает ускорить процесс создания тестов, особенно в случаях, когда нам нужно создать множество объектов одной модели:
   ```python
   @pytest.fixture
   def message_factory():
       def factory(*args, **kwargs):
           return baker.make(Message, *args, **kwargs)
       return factory
   ```

4. **Покрытие кода тестами с помощью `pytest-cov`**:
   Мы рассмотрели, как измерять покрытие кода тестами с использованием библиотеки `pytest-cov`. Это важно для оценки того, насколько полно наш код покрыт тестами, и для выявления участков, которые еще не тестировались:
   ```bash
   pytest --cov=app_django_pytest
   ```

   Покрытие тестами позволяет отслеживать, какие части кода проходят проверку, и это помогает сделать приложение более надежным и безопасным.

5. **Исключение файлов и папок из покрытия тестами**:
   Мы изучили, как исключать ненужные файлы и папки из покрытия тестами с помощью настроек конфигурации `.coveragerc`. Это позволяет сосредоточиться только на тех файлах, которые действительно требуют тестирования:
   ```
   [run]
   omit = tests/*, .venv/*, manage.py, project_django_pytest/*
   ```

## Реализованные тесты

### Тест получения сообщений:
Этот тест проверяет, что API возвращает правильный список сообщений.
```python
@pytest.mark.django_db
def test_get_messages(client, user, message_factory):
    messages = message_factory(_quantity=10)
    response = client.get('/api/messages/')
    assert response.status_code == 200
    data = response.json()
    assert len(data) == len(messages)
    for index, message in enumerate(data):
        assert message['text'] == messages[index].text
```

### Тест создания сообщения:
Этот тест проверяет, что новое сообщение может быть успешно создано через API.
```python
@pytest.mark.django_db
def test_create_message(client, user):
    count = Message.objects.count()
    response = client.post(
        '/api/messages/',
        data={
            'user': user.id,
            'text': "Привет Мир!",
        }
    )
    assert response.status_code == 201
    assert Message.objects.count() == count + 1
```

## Чему мы научились:

- Настраивать тестирование в Django с использованием `pytest` для работы с API.
- Организовывать фикстуры для создания клиентов, пользователей и объектов модели.
- Использовать `model_bakery` для упрощенного создания тестовых данных.
- Измерять покрытие кода тестами с помощью `pytest-cov`.
- Исключать ненужные файлы и папки из покрытия тестами.
- Понимать важность покрытия кода тестами для обеспечения стабильности и надежности приложения.

## Запуск тестов
Для запуска тестов используйте следующую команду:
```bash
pytest
```

Для проверки покрытия кода тестами:
```bash
pytest --cov=app_django_pytest
```

## Полезные ссылки

- [Документация Pytest для Django](https://pytest-django.readthedocs.io/en/latest/)
- [Документация model_bakery](https://model-bakery.readthedocs.io/en/latest/)
- [Покрытие кода с pytest-cov](https://pytest-cov.readthedocs.io/en/latest/)